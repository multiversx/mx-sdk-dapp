import{a as _}from"./chunk-5MUPDI3B.js";import{a as x}from"./chunk-AFHIR5VN.js";import{a as $}from"./chunk-VNBITWQT.js";import{a as G}from"./chunk-EFGVEBF6.js";import{d as W}from"./chunk-K3GCLKZ7.js";import{c as O,d as b}from"./chunk-JUB6TCFX.js";import{s as as}from"./chunk-7OZRG2YY.js";import{a as D}from"./chunk-P3EO43BR.js";import{a as N,b as ts}from"./chunk-N4YFXMKQ.js";import{a as L,e as A}from"./chunk-BQNI2XMA.js";import{a as rs}from"./chunk-NJJDLNA3.js";import{b as g,c as R,d as y}from"./chunk-3VZRJQDC.js";import{j as U}from"./chunk-LRON2GMF.js";import{a as v}from"./chunk-7XYHQ72T.js";import{x as es}from"./chunk-UDZUNVED.js";import{a as m,b as c,e as P}from"./chunk-7YHU2LQD.js";import{a as T,b as ns}from"./chunk-OWBHRN3S.js";import{a as ss}from"./chunk-OPT3JYNI.js";import{a as h}from"./chunk-W6HPOJ7Z.js";import{a as M,b as p,j as d,k as I,m as C}from"./chunk-HBP5N4FR.js";C();es();import{useEffect as E,useState as is}from"react";import{Address as os,Message as cs}from"@multiversx/sdk-core";as();rs();ss();ts();ns();var vs=j=>{let t=O(),[l,u]=is(""),S=b(L).signedSessions[l],{isPending:k,errorMessage:z}=_(),{search:w,origin:F}=T(),{provider:a,providerType:H}=x(),f=H==="wallet",Q=b(A),V=()=>(t(R()),D({removeParams:Object.keys(h)})),i=({callbackRoute:r,errorMessage:n=c})=>{let e=n.includes(c),s=Date.now().toString();S||u(s),t(g({errorMessage:n,sessionId:s,signedSession:{callbackUrl:r,status:e?"cancelled":"failed"}})),t(U(n))},Z=(r,n)=>{if(!r)return"";let e=new URL(v(r));return e.searchParams.get("sessionId")||e.searchParams.append("sessionId",n),`${f?F:""}${e.pathname}${e.search}${e.hash}`},q=()=>d(void 0,null,function*(){var n;if(f)return;let r=yield(n=a==null?void 0:a.init)==null?void 0:n.call(a);if(!!r)return r}),B=e=>d(void 0,[e],function*({message:r,callbackRoute:n}){let s=yield G(),o=W(),X=encodeURIComponent(String(n)),Y=new cs({address:new os(s),data:I.Buffer.from(r)});return o.signMessage(Y,{callbackUrl:X})}),J=r=>d(void 0,null,function*(){let n=Date.now().toString();u(n);let e=Z(r.callbackRoute,n);if(t(g({sessionId:n,signedSession:{status:"pending",message:r.message,callbackUrl:e}})),f)return B(p(M({},r),{callbackRoute:e}));try{yield q()}catch(s){let o=(s==null?void 0:s.message)||s||P;return console.error(o),i({errorMessage:P,callbackRoute:e}),null}try{let s=yield $(p(M({},r),{callbackRoute:e,options:j}));if(s!=null&&s.signature)return t(g({sessionId:n,signedSession:{status:"signed",callbackUrl:e,message:r.message,signature:I.Buffer.from(s==null?void 0:s.signature).toString("hex")}})),s;i({errorMessage:c,callbackRoute:e})}catch(s){let o=(s==null?void 0:s.message)||s||m;console.error(o),i({errorMessage:m,callbackRoute:e})}return null}),K=()=>{if(w){let{remainingParams:{signature:r,sessionId:n,status:e},clearNavigationHistory:s}=N(Object.values(h));if(!n)return;u(n),["cancelled","failed"].includes(e)&&i({errorMessage:e==="cancelled"?c:m}),r&&e==="signed"&&t(g({sessionId:n,signedSession:{signature:r,status:e}})),s()}};return E(()=>{K()},[w]),E(()=>{(k||z)&&!S&&t(y({isSigning:!1,errorMessage:""}))},[]),E(()=>{l&&!S&&!k&&t(y({isSigning:!1,errorMessage:""}))},[l]),{onAbort:V,onCancel:i,signMessage:J,sessionId:l||Q}};export{vs as a};
//# sourceMappingURL=chunk-7YUXIU6S.js.map
