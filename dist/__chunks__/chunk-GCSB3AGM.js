import{a as U}from"./chunk-4MBWSVL5.js";import{a as O}from"./chunk-UQ4TKO4K.js";import{a as F}from"./chunk-XUD3HGD3.js";import{a as x}from"./chunk-JESPSC4I.js";import{a as D,b as so}from"./chunk-KFSX2APT.js";import{a as N}from"./chunk-K3GCLKZ7.js";import{c as A,d as M}from"./chunk-JUB6TCFX.js";import{i as E,o as ro}from"./chunk-S55DZJQR.js";import{a as to}from"./chunk-NJJDLNA3.js";import{c as v,d as W}from"./chunk-P6ZSBO2H.js";import{a as io}from"./chunk-R4M6QQ4K.js";import{a as k}from"./chunk-4CZQ6YQW.js";import{b as S,c as no}from"./chunk-7RBRFERR.js";import{b as C,c as oo}from"./chunk-U3D33KB2.js";import{h as T,j as b}from"./chunk-7YHU2LQD.js";import{a as P,b as eo}from"./chunk-OWBHRN3S.js";import{p as Z}from"./chunk-EOZJRV5E.js";import{a as p,d as Y}from"./chunk-2SDQY5CF.js";import{a as d,b as h,j as y,m as I}from"./chunk-HBP5N4FR.js";I();import{useState as G}from"react";oo();b();Y();no();ro();to();Z();so();io();eo();var Mo=({callbackRoute:e,token:_,nativeAuth:m,onLoginRedirect:B,hasConsentPopup:H,walletAddress:t})=>{let[f,R]=G(""),[$,r]=G(!1),l=m!=null,s=O(m),o=_,z=M(E),a=A(),L=U();function j(){return y(this,null,function*(){if(L)throw new Error(T);F({skipLoginMethod:"crossWindow"}),r(!0);let q=yield p.getInstance().init(),g=p.getInstance().setWalletUrl(t!=null?t:z.walletAddress);try{if(!q){console.warn("Something went wrong trying to redirect to wallet login..");return}let{origin:i,pathname:J}=P(),K=encodeURIComponent(`${i}${e!=null?e:J}`);if(l&&!o&&(o=yield s.getNativeAuthLoginToken(),!o)){console.warn("Fetching block failed. Login cancelled.");return}o&&s.setLoginToken(o);let Q=d({callbackUrl:K},o&&{token:o});(C&&l||H)&&g.setShouldShowConsentPopup(!0);let{signature:u,address:w,multisig:V,impersonate:X}=yield g.login(Q);if(N(g),!w){r(!1),console.warn("Login cancelled.");return}let n=yield x({loginToken:o,extraInfoData:{multisig:V,impersonate:X},address:w,signature:u,loginService:s});if(!n)return;a(S({address:n.address,loginMethod:"crossWindow"})),a(W(n.address)),a(v(h(d({},n),{nonce:D(n)}))),k({callbackRoute:e,onLoginRedirect:B,options:{signature:u,address:n.address}})}catch(i){console.error("error loging in",i),R("error logging in"+i.message)}finally{r(!1)}})}let c=Boolean(f);return[j,{loginFailed:c,error:f,isLoading:$&&!c,isLoggedIn:L&&!c}]};export{Mo as a};
//# sourceMappingURL=chunk-GCSB3AGM.js.map
