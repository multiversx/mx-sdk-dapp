{
  "version": 3,
  "sources": ["../../src/__mocks__/packages/createSubscription.ts"],
  "sourcesContent": ["// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-nocheck\nexport const createSubscription = (store, parentSub) => {\n  function defaultNoopBatch(callback) {\n    callback();\n  }\n\n  const batch = defaultNoopBatch; // Allow injecting another batching function later\n\n  const getBatch = () => batch;\n  function createListenerCollection() {\n    const batch = getBatch();\n    let first = null;\n    let last = null;\n    return {\n      clear() {\n        first = null;\n        last = null;\n      },\n\n      notify() {\n        batch(() => {\n          let listener = first;\n\n          while (listener) {\n            listener.callback();\n            listener = listener.next;\n          }\n        });\n      },\n\n      get() {\n        const listeners = [];\n        let listener = first;\n\n        while (listener) {\n          listeners.push(listener);\n          listener = listener.next;\n        }\n\n        return listeners;\n      },\n\n      subscribe(callback) {\n        let isSubscribed = true;\n        const listener = (last = {\n          callback,\n          next: null,\n          prev: last\n        });\n\n        if (listener.prev) {\n          listener.prev.next = listener;\n        } else {\n          first = listener;\n        }\n\n        return function unsubscribe() {\n          if (!isSubscribed || first === null) return;\n          isSubscribed = false;\n\n          if (listener.next) {\n            listener.next.prev = listener.prev;\n          } else {\n            last = listener.prev;\n          }\n\n          if (listener.prev) {\n            listener.prev.next = listener.next;\n          } else {\n            first = listener.next;\n          }\n        };\n      }\n    };\n  }\n  const nullListeners = {\n    notify: () => ({}),\n\n    get: () => []\n  };\n  let unsubscribe;\n  // eslint-disable-next-line @typescript-eslint/no-use-before-define\n  let listeners = nullListeners;\n\n  function addNestedSub(listener) {\n    trySubscribe();\n    return listeners.subscribe(listener);\n  }\n\n  function notifyNestedSubs() {\n    listeners.notify();\n  }\n\n  function handleChangeWrapper() {\n    // eslint-disable-next-line @typescript-eslint/no-use-before-define\n    if (subscription.onStateChange) {\n      // eslint-disable-next-line @typescript-eslint/no-use-before-define\n      subscription.onStateChange();\n    }\n  }\n\n  function isSubscribed() {\n    return Boolean(unsubscribe);\n  }\n\n  function trySubscribe() {\n    if (!unsubscribe) {\n      unsubscribe = parentSub\n        ? parentSub.addNestedSub(handleChangeWrapper)\n        : store.subscribe(handleChangeWrapper);\n      listeners = createListenerCollection();\n    }\n  }\n\n  function tryUnsubscribe() {\n    if (unsubscribe) {\n      unsubscribe();\n      unsubscribe = undefined;\n      listeners.clear();\n      listeners = nullListeners;\n    }\n  }\n\n  const subscription = {\n    addNestedSub,\n    notifyNestedSubs,\n    handleChangeWrapper,\n    isSubscribed,\n    trySubscribe,\n    tryUnsubscribe,\n    getListeners: () => listeners\n  };\n  return subscription;\n};\n"],
  "mappings": "wCAAA,IAEO,GAAM,GAAqB,CAAC,EAAO,IAAc,CACtD,WAA0B,EAAU,CAClC,EAAS,CACX,CAEA,GAAM,GAAQ,EAER,EAAW,IAAM,EACvB,YAAoC,CAClC,GAAM,GAAQ,EAAS,EACnB,EAAQ,KACR,EAAO,KACX,MAAO,CACL,OAAQ,CACN,EAAQ,KACR,EAAO,IACT,EAEA,QAAS,CACP,EAAM,IAAM,CACV,GAAI,GAAW,EAEf,KAAO,GACL,EAAS,SAAS,EAClB,EAAW,EAAS,IAExB,CAAC,CACH,EAEA,KAAM,CACJ,GAAM,GAAY,CAAC,EACf,EAAW,EAEf,KAAO,GACL,EAAU,KAAK,CAAQ,EACvB,EAAW,EAAS,KAGtB,MAAO,EACT,EAEA,UAAU,EAAU,CAClB,GAAI,GAAe,GACb,EAAY,EAAO,CACvB,WACA,KAAM,KACN,KAAM,CACR,EAEA,MAAI,GAAS,KACX,EAAS,KAAK,KAAO,EAErB,EAAQ,EAGH,UAAuB,CAC5B,AAAI,CAAC,GAAgB,IAAU,MAC/B,GAAe,GAEf,AAAI,EAAS,KACX,EAAS,KAAK,KAAO,EAAS,KAE9B,EAAO,EAAS,KAGlB,AAAI,EAAS,KACX,EAAS,KAAK,KAAO,EAAS,KAE9B,EAAQ,EAAS,KAErB,CACF,CACF,CACF,CACA,GAAM,GAAgB,CACpB,OAAQ,IAAO,EAAC,GAEhB,IAAK,IAAM,CAAC,CACd,EACI,EAEA,EAAY,EAEhB,WAAsB,EAAU,CAC9B,SAAa,EACN,EAAU,UAAU,CAAQ,CACrC,CAEA,YAA4B,CAC1B,EAAU,OAAO,CACnB,CAEA,YAA+B,CAE7B,AAAI,EAAa,eAEf,EAAa,cAAc,CAE/B,CAEA,YAAwB,CACtB,MAAO,SAAQ,CAAW,CAC5B,CAEA,YAAwB,CACtB,AAAK,GACH,GAAc,EACV,EAAU,aAAa,CAAmB,EAC1C,EAAM,UAAU,CAAmB,EACvC,EAAY,EAAyB,EAEzC,CAEA,YAA0B,CACxB,AAAI,GACF,GAAY,EACZ,EAAc,OACd,EAAU,MAAM,EAChB,EAAY,EAEhB,CAEA,GAAM,GAAe,CACnB,eACA,mBACA,sBACA,eACA,eACA,iBACA,aAAc,IAAM,CACtB,EACA,MAAO,EACT",
  "names": []
}
