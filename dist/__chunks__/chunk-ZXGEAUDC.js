import{a as D}from"./chunk-4MBWSVL5.js";import{a as A}from"./chunk-UQ4TKO4K.js";import{a as G}from"./chunk-XUD3HGD3.js";import{a as R}from"./chunk-JESPSC4I.js";import{a as x,b as eo}from"./chunk-KFSX2APT.js";import{a as P}from"./chunk-K3GCLKZ7.js";import{c as E,d as M}from"./chunk-JUB6TCFX.js";import{a as N,b as O}from"./chunk-PVNL3U3S.js";import{i as U,o as oo}from"./chunk-S55DZJQR.js";import{a as b}from"./chunk-NJJDLNA3.js";import{c as k}from"./chunk-P6ZSBO2H.js";import{b as S,c as Y}from"./chunk-7RBRFERR.js";import{h,j as X}from"./chunk-7YHU2LQD.js";import{a as v,b as Z}from"./chunk-OWBHRN3S.js";import{a as V}from"./chunk-OPT3JYNI.js";import{a as c,b as y,j as T,m as w}from"./chunk-HBP5N4FR.js";w();import{useState as W}from"react";X();Y();oo();b();V();eo();Z();var vo=({callbackRoute:t,token:_,nativeAuth:m,walletAddress:i})=>{let[f,p]=W(""),[C,s]=W(!1),F=m!=null,a=A(m),o=_,H=M(U),l=E(),L=D();function $(){return T(this,arguments,function*(d=O.metamask){if(L)throw new Error(h);G({skipLoginMethod:"iframe"}),s(!0);let e=N.getInstance(),u=i!=null?i:H.metamaskSnapWalletAddress;if(!u){p("Iframe snap wallet URL is not set");return}e.setLoginType(d),e.setWalletUrl(u);let z=yield e.init();try{if(!z){console.warn("Something went wrong trying to redirect to wallet login..");return}let{origin:n,pathname:B}=v(),j=encodeURIComponent(`${n}${t!=null?t:B}`);if(F&&!o&&(o=yield a.getNativeAuthLoginToken(),!o)){console.warn("Fetching block failed. Login cancelled.");return}o&&a.setLoginToken(o);let q=c({callbackUrl:j},o&&{token:o}),{signature:J,address:I,multisig:K,impersonate:Q}=yield e.login(q);if(P(e),!I){s(!1),console.warn("Login cancelled.");return}let r=yield R({loginToken:o,extraInfoData:{multisig:K,impersonate:Q},address:I,signature:J,loginService:a});if(!r)return;l(S({address:r.address,loginMethod:"iframe",iframeLoginType:d})),l(k(y(c({},r),{nonce:x(r)})))}catch(n){console.error("error loging in",n),p("error logging in"+n.message)}finally{s(!1)}})}let g=Boolean(f);return[$,{loginFailed:g,error:f,isLoading:C&&!g,isLoggedIn:L&&!g}]};export{vo as a};
//# sourceMappingURL=chunk-ZXGEAUDC.js.map
