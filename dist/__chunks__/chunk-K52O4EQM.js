import{a as Q}from"./chunk-7AHPPG66.js";import{a as X}from"./chunk-I2YCVINV.js";import{a as k}from"./chunk-BDWKIY35.js";import{a as K}from"./chunk-U6HTR5RX.js";import{a as J,b as dn}from"./chunk-XNFCZFZP.js";import{a as z,b as un}from"./chunk-J42ZO72F.js";import{x as ln}from"./chunk-UDZUNVED.js";import{i as q}from"./chunk-7YHU2LQD.js";import{a as d,j as y,m as H}from"./chunk-HBP5N4FR.js";H();import{useEffect as gn,useState as x}from"react";import{Address as Y,TransactionOptions as fn,TransactionVersion as Tn}from"@multiversx/sdk-core";ln();un();dn();var D={},Nn=({isLedger:b=!1,transactionsToSign:h,egldLabel:Z,address:g,activeGuardianAddress:I,hasGuardianScreen:$,onCancel:a,onSignTransaction:C,onTransactionsSignError:nn,onTransactionsSignSuccess:G,onGetScamAddressData:M})=>{var L,U,W,_;let A=Boolean(I),[c,i]=x(0),[l,E]=x(),[e,en]=x(null),[tn,F]=x(!1),{getTxInfoByDataField:sn,allTransactions:s}=Q({transactions:I?h==null?void 0:h.map(n=>{n.setSender(Y.fromBech32(g)),n.setVersion(Tn.withTxOptions()),n.setGuardian(Y.fromBech32(I));let t=d({guarded:!0},b?{hashSign:!0}:{});return n.setOptions(fn.withOptions(t)),n}):h}),w=c===s.length-1,B=s[c],f=(L=e==null?void 0:e.transaction)==null?void 0:L.getSender().toString(),{data:O}=K(!f||f===g?null:f),rn=()=>y(void 0,null,function*(){var j;if(B==null)return;let{transaction:n,multiTxData:t,transactionIndex:T}=B,v=n.getData().toString(),u=sn(n.getData().toString(),t),{tokenId:p}=u,r=n.getReceiver().toString();if(f&&f!==g&&!X(O,g))return console.error(q),a==null?void 0:a();let o=g!==r,R=r in D;if(r&&o&&!R&&M!=null){let m=yield M(r);D=d(d({},D),m!=null&&m.scamInfo?{[r]:m.scamInfo}:{})}let S=Boolean(p&&J({tokenId:p,erdLabel:Z}));en({transaction:n,receiverScamInfo:((j=D[r])==null?void 0:j.info)||null,transactionTokenInfo:u,isTokenTransaction:S,dataField:v,transactionIndex:T})});gn(()=>{rn()},[B,O]);let N=()=>{i(0),E(void 0),F(!1)},P=()=>y(void 0,null,function*(){let n=Object.values(l!=null?l:{}),t=k({isGuarded:A,transactions:n});if(A&&t){G(n),N();return}if(e==null)return;F(b);let T;try{T=yield C(e.transaction)}catch(o){console.error(o,"sign error");let{message:R}=o,S=b?z(o).errorMessage:null;N(),nn(S!=null?S:R);return}if(!T)return;let v={[c]:T},u=l?d(d({},l),v):v;if(E(u),!w){i(o=>o+1),F(!1);return}if(!u)return;let p=Object.values(u);!k({isGuarded:A,transactions:p})&&$||(G(p),N())}),on=()=>y(void 0,null,function*(){try{if(e==null)return;if(e.transaction.getSignature().toString("hex")&&!w){i(t=>t+1);return}yield P()}catch(n){console.error("Error during signing transaction"),yield P()}}),an=c===0,cn=()=>{an?a==null||a():i(n=>n-1)},V=Boolean(((U=e==null?void 0:e.transactionTokenInfo)==null?void 0:U.type)&&((W=e==null?void 0:e.transactionTokenInfo)==null?void 0:W.multiTxData)&&!(e!=null&&e.dataField.endsWith((_=e==null?void 0:e.transactionTokenInfo)==null?void 0:_.multiTxData)));return{allTransactions:s,onSignTransaction:()=>y(void 0,null,function*(){if(V){i(n=>n+1);return}yield on()}),onNext:()=>{i(n=>{let t=n+1;return t>(s==null?void 0:s.length)?n:t})},onPrev:()=>{i(n=>{let t=n-1;return t<0?n:t})},waitingForDevice:tn,onAbort:cn,isLastTransaction:w,isFirstTransaction:c===0,hasMultipleTransactions:s.length>1,shouldContinueWithoutSigning:V,currentStep:c,signedTransactions:l,setSignedTransactions:E,currentTransaction:e}};export{Nn as a};
//# sourceMappingURL=chunk-K52O4EQM.js.map
