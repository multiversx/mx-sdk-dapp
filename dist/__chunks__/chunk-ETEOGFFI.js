import{a as de}from"./chunk-YTYNUTPN.js";import{a as me}from"./chunk-7LBCKPET.js";import{a as pe}from"./chunk-HCNYEZXZ.js";import{a as j}from"./chunk-4MBWSVL5.js";import{a as ge}from"./chunk-UQ4TKO4K.js";import{a as ve}from"./chunk-XUD3HGD3.js";import{a as ue}from"./chunk-AFHIR5VN.js";import{a as fe}from"./chunk-JVZLMSFE.js";import{a as le}from"./chunk-K3GCLKZ7.js";import{b as V,f as ae}from"./chunk-KQPPULAV.js";import{e as W,f as se}from"./chunk-4JP4CKHO.js";import{c as ce,d as g}from"./chunk-JUB6TCFX.js";import{s as je}from"./chunk-7OZRG2YY.js";import{b as ee,i as ne}from"./chunk-HKOZWGGV.js";import{e as te,f as oe,g as re,h as ie,o as Ne}from"./chunk-S55DZJQR.js";import{a as De}from"./chunk-NJJDLNA3.js";import{c as X}from"./chunk-L5S5P5OY.js";import{a as ke}from"./chunk-R4M6QQ4K.js";import{a as Z}from"./chunk-4CZQ6YQW.js";import{b as Q,c as Ae}from"./chunk-7RBRFERR.js";import{a as Y,b as Re}from"./chunk-OWBHRN3S.js";import{p as Ue}from"./chunk-EOZJRV5E.js";import{j as u,m as J}from"./chunk-HBP5N4FR.js";J();import{useEffect as O,useRef as H,useState as C}from"react";Ae();je();Ne();De();Ue();ke();Re();var Oe=(n=>(n.invalidAddress="Invalid address",n.invalidConfig="Invalid WalletConnect setup",n.invalidTopic="Expired connection",n.sessionExpired="Unable to connect to existing session",n.connectError="Unable to connect",n.userRejected="User rejected connection proposal",n.userRejectedExisting="User rejected existing connection proposal",n.errorLogout="Unable to remove existing pairing",n.invalidChainID="Invalid chainID",n))(Oe||{}),gn=({callbackRoute:y,token:b,nativeAuth:M,onLoginRedirect:we,logoutRoute:x,customRequestMethods:Ce=[]})=>{var $;let G=ce(),L=pe(M),p=ge(L?M:!1),n=b,[_,l]=C(""),[h,ye]=C(""),[F,f]=C(!0),[Le,U]=C([]),[T,A]=C(null),{provider:R}=ue(),E=g(te),I=g(oe),P=g(re),he=g(ie),Te=g(ne),Ee=g(ee),e=H(R),m=H(!1),v=H(!1),B=($=x!=null?x:Te)!=null?$:"/",S=[W.CANCEL_ACTION,...Ce];b&&S.push(W.SIGN_LOGIN_TOKEN),L&&S.push(W.SIGN_NATIVE_AUTH_TOKEN);let Ie=F?"":`${he}?wallet-connect=${encodeURIComponent(h)}`,k=Boolean(_),D=j(),Pe=()=>{fe(B)},Se=t=>{console.log("WalletConnect Session Event: ",t)},We=()=>u(void 0,null,function*(){var t,o,r,i;try{if(m.current||e.current==null)return;if(!v.current){try{yield(t=e.current)==null?void 0:t.logout()}catch(N){console.warn("Unable to logout")}return}let c=yield(r=(o=e.current)==null?void 0:o.getAddress)==null?void 0:r.call(o);if(!c){console.warn("Login cancelled.");return}let a=yield(i=e.current)==null?void 0:i.getSignature(),s={address:c,loginMethod:"walletconnectv2"},d={logoutRoute:B,loginType:"walletconnectv2",callbackRoute:y!=null?y:Y().href};G(X(d)),a&&p.setTokenLoginInfo({signature:a,address:c}),G(Q(s)),Z({callbackRoute:y,onLoginRedirect:we,options:{address:c,signature:a}})}catch(c){l("User rejected connection proposal"),console.error(c)}}),z=()=>u(void 0,null,function*(){var o,r,i,c,a;if(V(e.current)==="walletconnectv2")try{((c=(i=(r=(o=e.current)==null?void 0:o.walletConnector)==null?void 0:r.session)==null?void 0:i.getAll())!=null?c:[]).length>0&&(yield(a=e.current)==null?void 0:a.logout()),e.current=ae,A(null)}catch(s){console.warn("Unable to logout")}}),Ve=t=>u(void 0,null,function*(){var o,r,i;if(!E||!I){l("Invalid WalletConnect setup");return}if(!t||!t.topic){l("Expired connection");return}try{if((e.current?V(e.current):!1)!=="walletconnectv2"){yield w();return}if(f(!0),yield z(),L&&!n&&(n=yield p.getNativeAuthLoginToken(),!n)){console.warn("Fetching block failed. Login cancelled.");return}n&&p.setLoginToken(n),yield w(!1);let{approval:a}=yield(o=e.current)==null?void 0:o.connect({topic:t.topic,methods:S});try{yield(r=e.current)==null?void 0:r.login({approval:a,token:n})}catch(s){console.error("User rejected existing connection proposal",s),l("User rejected existing connection proposal"),f(!0),yield w()}}catch(c){console.error("Unable to connect to existing session",c),l("Unable to connect to existing session")}finally{U((i=e.current)==null?void 0:i.pairings)}}),xe=t=>u(void 0,null,function*(){var o,r;try{t&&(yield(o=e.current)==null?void 0:o.logout({topic:t}))}catch(i){console.error("Unable to remove existing pairing",i),l("Unable to remove existing pairing")}finally{let i=yield(r=e.current)==null?void 0:r.getPairings();U(i)}});function w(t=!0){return u(this,null,function*(){var d,N,q;ve();let o=yield me({maxRetries:15});if(!o){console.error("Invalid chainID"),l("Invalid chainID");return}if(!I||!E){console.error("Invalid WalletConnect setup"),l("Invalid WalletConnect setup");return}let r=j(),i=v.current===!1&&!r,c=(N=(d=e.current)==null?void 0:d.isInitialized)==null?void 0:N.call(d);if(m.current||i||c)return;if(m.current=!0,(q=e.current)!=null&&q.walletConnector){yield e.current.init(),A(e.current),m.current=!1,t&&(yield K());return}let a={onClientLogin:We,onClientLogout:Pe,onClientEvent:Se},s=new se(a,o,E,I,P);yield s.init(),A(s),e.current=s,m.current=!1,t&&(U(s.pairings),yield K())})}function K(){return u(this,null,function*(){var t,o;if(!!e.current){if(!E||!I){l("Invalid WalletConnect setup");return}try{if(!v.current)return;let{uri:r,approval:i}=yield(t=e.current)==null?void 0:t.connect({methods:S});if(!Boolean(r))return;if(ye(r),(P==null?void 0:P.logger)==="debug"&&console.log("WalletConnect uri: ",r),L&&!n&&(n=yield p.getNativeAuthLoginToken(),!n)){console.warn("Fetching block failed. Login cancelled.");return}if(n&&p.setLoginToken(n),(e.current?V(e.current):!1)!=="walletconnectv2"){f(!0),yield w();return}try{yield(o=e.current)==null?void 0:o.login({approval:i,token:n})}catch(s){console.error("User rejected connection proposal",s),l("User rejected connection proposal"),f(!0)}}catch(r){console.error("Unable to connect",r)}}})}return de(()=>{e.current=R},[R]),O(()=>(v.current=!0,()=>{v.current=!1}),[]),O(()=>{f(!h)},[h]),O(()=>{if(!T)return;(Boolean(T.session)||Ee==="walletconnectv2")&&D&&le(T)},[T,D]),[w,{error:_,loginFailed:k,isLoading:F&&!k,isLoggedIn:D&&!k},{uriDeepLink:Ie,walletConnectUri:h,cancelLogin:z,connectExisting:Ve,removeExistingPairing:xe,wcPairings:Le}]};export{Oe as a,gn as b};
//# sourceMappingURL=chunk-ETEOGFFI.js.map
