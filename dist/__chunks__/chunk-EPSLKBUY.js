import{a as M}from"./chunk-4MBWSVL5.js";import{a as S}from"./chunk-UQ4TKO4K.js";import{a as P}from"./chunk-XUD3HGD3.js";import{a as v}from"./chunk-K3GCLKZ7.js";import{c as w}from"./chunk-JUB6TCFX.js";import{a as R}from"./chunk-R4M6QQ4K.js";import{a as h}from"./chunk-4CZQ6YQW.js";import{a as I,c as k}from"./chunk-UORIA4VW.js";import{a as T}from"./chunk-7XYHQ72T.js";import{b as y,c as H}from"./chunk-7RBRFERR.js";import{h as u,j as z}from"./chunk-7YHU2LQD.js";import{p as x}from"./chunk-EOZJRV5E.js";import{a as f,j as p,m as L}from"./chunk-HBP5N4FR.js";L();z();import{useState as E}from"react";import{MetamaskProvider as B}from"@multiversx/sdk-metamask-provider/out/metamaskProvider";H();x();R();k();k();var ro=({callbackRoute:n,token:O,nativeAuth:c,onLoginRedirect:U})=>{let[l,m]=E(""),[A,t]=E(!1),C=c!=null,r=S(c),o=O,D=w(),d=M();function F(){return p(this,null,function*(){if(d)throw new Error(u);P(),t(!0);let e=B.getInstance();try{if(!(yield e.init())){console.warn("Something went wrong trying to redirect to wallet login..");return}let N=I(),G=encodeURIComponent(T(n!=null?n:N));if(C&&!o&&(o=yield r.getNativeAuthLoginToken(),!o)){console.warn("Fetching block failed. Login cancelled.");return}o&&r.setLoginToken(o);let _=f({callbackUrl:G},o&&{token:o});yield e.login(_),v(e);let{signature:g,address:i}=e.account;if(!i){t(!1),console.warn("Login cancelled."),m("Login cancelled");return}g&&o&&r.setTokenLoginInfo({signature:g,address:i}),D(y({address:i,loginMethod:"metamask"})),h({callbackRoute:n,onLoginRedirect:U,options:{signature:g,address:i}})}catch(a){console.error("error logging in",a),m("error logging in"+a.message)}finally{t(!1)}})}let s=Boolean(l);return[F,{loginFailed:s,error:l,isLoading:A&&!s,isLoggedIn:d&&!s}]};export{ro as a};
//# sourceMappingURL=chunk-EPSLKBUY.js.map
