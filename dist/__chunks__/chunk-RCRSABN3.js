import{a as Y}from"./chunk-R5ZOBQLY.js";import{a as K}from"./chunk-4MBWSVL5.js";import{a as J}from"./chunk-UQ4TKO4K.js";import{a as Q}from"./chunk-XUD3HGD3.js";import{a as j,d as q}from"./chunk-K3GCLKZ7.js";import{d as V}from"./chunk-KQPPULAV.js";import{c as X,d as B}from"./chunk-JUB6TCFX.js";import{s as Pe}from"./chunk-7OZRG2YY.js";import{g as $}from"./chunk-S6FCTAUC.js";import{a as Se}from"./chunk-NJJDLNA3.js";import{g as T,h as R}from"./chunk-P6ZSBO2H.js";import{d as U}from"./chunk-L5S5P5OY.js";import{a as Te}from"./chunk-R4M6QQ4K.js";import{a as S}from"./chunk-4CZQ6YQW.js";import{a as _}from"./chunk-J42ZO72F.js";import{b as v,c as ve}from"./chunk-7RBRFERR.js";import{h as W,j as Ie}from"./chunk-7YHU2LQD.js";import{p as Ae}from"./chunk-EOZJRV5E.js";import{a as M,b as N,j as d,k as O,m as F}from"./chunk-HBP5N4FR.js";F();Ie();import{useEffect as Z,useState as ee}from"react";import{HWProvider as te}from"@multiversx/sdk-hw-provider";ve();Pe();Se();Ae();Te();var f="Check if the MultiversX App is open on Ledger",Xe=({callbackRoute:P,token:oe,addressesPerPage:L,nativeAuth:x,onLoginRedirect:k})=>{let E=B($),i=q(),c=X(),z=K(),ne=x!=null,m=J(x),l=oe,{accounts:r,setAccounts:ie,isLoading:b,setIsLoading:s,setShowAddressList:h,showAddressList:y,startIndex:u,selectedAddress:a,onGoToPrevPage:re,onGoToNextPage:se,onGoToSpecificPage:ae,onSelectAddress:de,error:w,setError:p,defaultAddressesPerPage:ce}=Y(),le=L!=null?L:ce,[C,ge]=ee(""),[H,fe]=ee(!1),G=({address:e,index:t,signature:o})=>{c(U({index:t,loginType:"ledger"})),o&&m.setTokenLoginInfo({signature:o,address:e}),c(v({address:e,loginMethod:"ledger"})),S({callbackRoute:P,onLoginRedirect:k,options:{address:e,signature:o}})},n=(e,t="")=>{var o;if(b){let{errorMessage:I,defaultErrorMessage:ye}=_(e),we=(o=I!=null?I:ye)!=null?o:f;p(`${we}.${t}`),s(!1),c(T(null))}},g=()=>d(void 0,null,function*(){try{if(i instanceof te&&i.isInitialized())return i.isConnected()}catch(e){n(e)}return!1}),ue=()=>d(void 0,null,function*(){if(yield g()){p(""),s(!1);return}try{let t=new te;(yield t.init())&&j(t),p(""),s(!1)}catch(t){n(t)}}),pe=()=>d(void 0,null,function*(){let e=yield g();if(!a||!e)return n(f);let{index:t}=a;if(ne&&!l&&(l=yield m.getNativeAuthLoginToken(),!l)){console.warn("Fetching block failed. Login cancelled.");return}if(l){m.setLoginToken(l);try{let o=yield i.tokenLogin({token:O.Buffer.from(`${l}{}`),addressIndex:t});G({address:o.address,index:t,signature:o.signature.toString("hex")})}catch(o){n(o,". Update MultiversX App to continue.")}}else try{let{address:o}=yield i.login({addressIndex:t});G({address:o,index:t})}catch(o){return n(o),!1}return!0}),Le=()=>d(void 0,null,function*(){try{if(s(!0),a==null)return!1;c(E?R(a):T(N(M({},a),{version:C,hasContractDataEnabled:H}))),s(!1),yield pe()}catch(e){n(e)}return h(!1),!0}),D=()=>d(void 0,null,function*(){if(!(yield g()))return n(w);try{s(!0);let t=yield i.getAccounts(u,le),o=yield V(i);ge(o.version),fe(o.dataEnabled),ie(t),s(!1)}catch(t){n(t)}}),me=()=>d(void 0,null,function*(){if(z)throw new Error(W);Q(),p("");try{if(s(!0),!(yield g()))return n(f);if(E!=null){if(!a)return n(f);let{address:t}=yield i.login({addressIndex:a.index.valueOf()});if(!t)return n("Login cancelled.");c(v({address:t,loginMethod:"ledger"})),S({callbackRoute:P,onLoginRedirect:k})}else r!=null&&r.length||(yield D()),h(!0);s(!1)}catch(e){n(e)}}),he=()=>d(void 0,null,function*(){try{let e=yield g();if(e||(yield ue()),e=yield g(),!e)return n(f);(r.length===0||u>=0)&&(yield D())}catch(e){n(e)}});Z(()=>{he()},[u,y,i]),Z(()=>{(r==null?void 0:r.length)>0&&!y&&h(!0)},[r]);let A=Boolean(w);return[me,{loginFailed:A,isLoggedIn:z&&!A,error:w,isLoading:b&&!A},{accounts:r,showAddressList:y,startIndex:u,selectedAddress:a,version:C,contractDataEnabled:H,onGoToPrevPage:re,onGoToNextPage:se,onGoToSpecificPage:ae,onSelectAddress:de,onConfirmSelectedAddress:Le}]};export{Xe as a};
//# sourceMappingURL=chunk-RCRSABN3.js.map
